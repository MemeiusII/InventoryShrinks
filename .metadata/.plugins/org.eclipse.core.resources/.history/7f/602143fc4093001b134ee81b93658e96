package me.EthanBilbrey.InventoryShrinks;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerQuitEvent;
import org.bukkit.event.player.PlayerRespawnEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.ItemMeta;

import net.md_5.bungee.api.ChatColor;

public class ChallengeInventoryManager implements Listener
{
	private static Player p;
	private static int taskId;
	private static int slot;
	private static int slotsFilled;
	private static ItemStack item;
	
	public ChallengeInventoryManager() {}
	public ChallengeInventoryManager(Player p) 
	{
		this.p = p;
		//first slot to take is 9, which is the top left slot
		slot = 9;
		slotsFilled = 0;
		startChallenge();
	}
	private static void startChallenge() 
	{
		taskId = Bukkit.getScheduler().scheduleSyncRepeatingTask(Main.getPlugin(Main.class), () -> {
			item = new ItemStack(Material.GRAY_STAINED_GLASS_PANE);
			ItemMeta meta = item.getItemMeta();
			meta.setDisplayName(" ");
			item.setItemMeta(meta);
			p.getInventory().setItem(slot, item);
			p.sendMessage(ChatColor.BOLD + "Inventory Shrunk!");
			slot++;
			slotsFilled++;
			if(slot >= 45) 
			{
				slot = 1;
			}
			else if(slot == 9) 
			{
				cancelTask();
			}
		}, 200L, 200L);
	}
	private static void cancelTask() 
	{
		Bukkit.getScheduler().cancelTask(taskId);
	}
	@EventHandler
	private static void onPlayerLeave(PlayerQuitEvent e) 
	{
		if(e.getPlayer().equals(p)) 
		{
			cancelTask();
		}
	}
	@EventHandler
	private static void onPlayerRespawn(PlayerRespawnEvent e) 
	{
		if(e.getPlayer().equals(p)) 
		{
			p.sendMessage("You respawned");
			if(slotsFilled < 45 && slotsFilled > 9) 
			{
				for(int i = 9; i < slotsFilled + 9; i++) 
				{
					p.getInventory().setItem(i, item);
				}
			}
			else if(slotsFilled <= 9)
			{
				for(int i = 0; i < 9; i++) 
				{
					p.getInventory().setItem(i, item);
				}
			}
		}
	}
}
